<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel do Atendente - Sistema Omnichannel</title>
  <link rel="stylesheet" href="../css/style.css">
  <style>
    body {
      display: flex;
      height: 100vh;
    }

    .sidebar {
      width: 350px;
      background: white;
      border-right: 1px solid #e5e7eb;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid #e5e7eb;
    }

    .sidebar-search {
      margin-bottom: 1rem;
    }

    .sidebar-search input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 0.875rem;
    }

    .sidebar-content {
      flex: 1;
      overflow-y: auto;
    }

    .conversation-item {
      padding: 1rem;
      border-bottom: 1px solid #f3f4f6;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .conversation-item:hover {
      background-color: #f9fafb;
    }

    .conversation-item.active {
      background-color: #eff6ff;
      border-left: 3px solid #2563eb;
    }

    .conversation-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .conversation-name {
      font-weight: 600;
      color: #1f2937;
    }

    .conversation-time {
      font-size: 0.75rem;
      color: #9ca3af;
    }

    .conversation-preview {
      font-size: 0.875rem;
      color: #6b7280;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: #f9fafb;
    }

    .header {
      background: white;
      border-bottom: 1px solid #e5e7eb;
      padding: 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-title h2 {
      margin: 0;
    }

    .header-actions {
      display: flex;
      gap: 1rem;
    }

    .chat-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .messages {
      flex: 1;
      overflow-y: auto;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .message {
      display: flex;
      margin-bottom: 1rem;
    }

    .message.sent {
      justify-content: flex-end;
    }

    .message.received {
      justify-content: flex-start;
    }

    .message-content {
      max-width: 60%;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      word-wrap: break-word;
    }

    .message.sent .message-content {
      background-color: #2563eb;
      color: white;
    }

    .message.received .message-content {
      background-color: white;
      border: 1px solid #e5e7eb;
      color: #1f2937;
    }

    .message-time {
      font-size: 0.75rem;
      color: #9ca3af;
      margin-top: 0.25rem;
      padding: 0 0.5rem;
    }

    .input-area {
      background: white;
      border-top: 1px solid #e5e7eb;
      padding: 1.5rem;
    }

    .input-group {
      display: flex;
      gap: 1rem;
    }

    .input-group textarea {
      flex: 1;
      padding: 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      resize: none;
      font-family: inherit;
    }

    .input-group button {
      padding: 0.75rem 1.5rem;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .input-group button:hover {
      background: #1e40af;
    }

    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #9ca3af;
    }

    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .queue-section {
      background: #fef3c7;
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 8px;
      border-left: 4px solid #f59e0b;
    }

    .queue-title {
      font-weight: 600;
      color: #92400e;
      margin-bottom: 0.5rem;
    }

    .queue-item {
      background: white;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .queue-item:hover {
      background: #f3f4f6;
    }

    @media (max-width: 1024px) {
      .sidebar {
        width: 280px;
      }

      .message-content {
        max-width: 80%;
      }
    }

    @media (max-width: 768px) {
      body {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        height: 200px;
        border-right: none;
        border-bottom: 1px solid #e5e7eb;
      }

      .main-content {
        flex: 1;
      }
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <h3 style="margin: 0 0 1rem 0;">Minhas Conversas</h3>
      <div class="sidebar-search">
        <input type="text" id="searchInput" placeholder="Buscar conversa...">
      </div>
    </div>

    <div class="sidebar-content">
      <!-- Fila de Espera -->
      <div class="queue-section">
        <div class="queue-title">ðŸ“‹ Fila de Espera (3)</div>
        <div class="queue-item" onclick="selecionarConversa(1)">
          <div style="font-weight: 600; font-size: 0.875rem;">Maria Silva</div>
          <div style="font-size: 0.75rem; color: #6b7280;">Agendamento de Consulta</div>
        </div>
        <div class="queue-item" onclick="selecionarConversa(2)">
          <div style="font-weight: 600; font-size: 0.875rem;">JoÃ£o Santos</div>
          <div style="font-size: 0.75rem; color: #6b7280;">Resultado de Exame</div>
        </div>
        <div class="queue-item" onclick="selecionarConversa(3)">
          <div style="font-weight: 600; font-size: 0.875rem;">Ana Costa</div>
          <div style="font-size: 0.75rem; color: #6b7280;">DÃºvida sobre Procedimento</div>
        </div>
      </div>

      <!-- Conversas -->
      <div id="conversationsList">
        <div class="conversation-item active" onclick="selecionarConversa(1)">
          <div class="conversation-header">
            <span class="conversation-name">ðŸ“± Maria Silva</span>
            <span class="conversation-time">14:32</span>
          </div>
          <div class="conversation-preview">Gostaria de agendar uma consulta...</div>
        </div>

        <div class="conversation-item" onclick="selecionarConversa(2)">
          <div class="conversation-header">
            <span class="conversation-name">ðŸ“· JoÃ£o Santos</span>
            <span class="conversation-time">13:15</span>
          </div>
          <div class="conversation-preview">Vim buscar o resultado do meu exame...</div>
        </div>

        <div class="conversation-item" onclick="selecionarConversa(3)">
          <div class="conversation-header">
            <span class="conversation-name">ðŸ‘¥ Ana Costa</span>
            <span class="conversation-time">12:45</span>
          </div>
          <div class="conversation-preview">Preciso fazer um ultrassom...</div>
        </div>

        <div class="conversation-item" onclick="selecionarConversa(4)">
          <div class="conversation-header">
            <span class="conversation-name">ðŸ“§ Pedro Oliveira</span>
            <span class="conversation-time">11:20</span>
          </div>
          <div class="conversation-preview">Cancelamento de Consulta</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Header -->
    <div class="header">
      <div class="header-title">
        <h2 id="conversationTitle">Selecione uma conversa</h2>
        <p style="color: #6b7280; margin: 0;">Atendimento via WhatsApp</p>
      </div>
      <div class="header-actions">
        <button class="btn btn-secondary btn-sm" onclick="mudarPerfil()">Trocar Perfil</button>
        <button class="btn btn-secondary btn-sm" onclick="fazerLogout()">Sair</button>
      </div>
    </div>

    <!-- Chat Area -->
    <div class="chat-area">
      <div class="messages" id="messagesList">
        <div class="message received">
          <div>
            <div class="message-content">OlÃ¡, gostaria de agendar uma consulta com cardiologista</div>
            <div class="message-time">14:30</div>
          </div>
        </div>
        <div class="message sent">
          <div>
            <div class="message-content">OlÃ¡! Vou verificar a disponibilidade para vocÃª</div>
            <div class="message-time">14:31</div>
          </div>
        </div>
        <div class="message received">
          <div>
            <div class="message-content">Qual seria a melhor data para vocÃª?</div>
            <div class="message-time">14:32</div>
          </div>
        </div>
      </div>

      <!-- Input Area -->
      <div class="input-area">
        <div class="input-group">
          <textarea id="messageInput" placeholder="Digite sua mensagem..." rows="2"></textarea>
          <button onclick="enviarMensagem()">Enviar</button>
        </div>
      </div>
    </div>
  </div>

  <script src="../js/conexao.js"></script>
  <script src="../js/utils.js"></script>
  <script>
    // Verificar autenticaÃ§Ã£o
    if (!estaAutenticado()) {
      window.location.href = '/pages/login.html';
    }

    let conversationAtual = 1;

    function selecionarConversa(id) {
      conversationAtual = id;
      
      // Atualizar UI
      document.querySelectorAll('.conversation-item').forEach(item => {
        item.classList.remove('active');
      });
      event.currentTarget.classList.add('active');

      // Simular carregamento de mensagens
      const nomes = ['Maria Silva', 'JoÃ£o Santos', 'Ana Costa', 'Pedro Oliveira'];
      document.getElementById('conversationTitle').textContent = nomes[id - 1];
    }

    function enviarMensagem() {
      const input = document.getElementById('messageInput');
      const mensagem = input.value.trim();

      if (!mensagem) return;

      // Criar elemento de mensagem
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message sent';
      messageDiv.innerHTML = `
        <div>
          <div class="message-content">${mensagem}</div>
          <div class="message-time">${new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}</div>
        </div>
      `;

      document.getElementById('messagesList').appendChild(messageDiv);
      input.value = '';
      input.focus();

      // Scroll para baixo
      const messagesList = document.getElementById('messagesList');
      messagesList.scrollTop = messagesList.scrollHeight;

      // Simular resposta
      setTimeout(() => {
        const responseDiv = document.createElement('div');
        responseDiv.className = 'message received';
        responseDiv.innerHTML = `
          <div>
            <div class="message-content">Obrigado pela mensagem! Estou processando sua solicitaÃ§Ã£o.</div>
            <div class="message-time">${new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}</div>
          </div>
        `;
        document.getElementById('messagesList').appendChild(responseDiv);
        messagesList.scrollTop = messagesList.scrollHeight;
      }, 1000);
    }

    function mudarPerfil() {
      window.location.href = '/pages/role-selection.html';
    }

    function fazerLogout() {
      localStorage.removeItem('token');
      localStorage.removeItem('user');
      window.location.href = '/pages/login.html';
    }

    // Permitir enviar com Enter
    document.getElementById('messageInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        enviarMensagem();
      }
    });
  </script>
</body>
</html>
